<!DOCTYPE html>
<html lang="en">
<head>
    <title>Manager The System</title>
    <meta http-equiv="content-type" content="text/html; charset=UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no" />
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <script type="text/javascript" src="{{url_for('static', filename='js/jquery-3.3.1.min.js')}}" ></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.2/dist/js/bootstrap.bundle.min.js" integrity="sha384-kQtW33rZJAHjgefvhyyzcGF3C5TFyBQBA13V1RKPf4uH+bwyzQxZ6CmMZHmNBEfJ" crossorigin="anonymous"></script>
    <script src="https://cdn.jsdelivr.net/npm/@popperjs/core@2.10.2/dist/umd/popper.min.js" integrity="sha384-7+zCNj/IqJ95wo16oMtfsKbZ9ccEh31eOz1HGyDuCQ6wgnyJNSYdrPa03rtR1zdB" crossorigin="anonymous"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.2/dist/js/bootstrap.min.js" integrity="sha384-PsUw7Xwds7x08Ew3exXhqzbhuEYmA2xnwc8BuD6SEr+UmEHlX8/MCltYEodzWA4u" crossorigin="anonymous"></script>
    <script src="https://cdn.bootcss.com/echarts/4.2.1-rc1/echarts.min.js"></script>
	<link rel="stylesheet" type="text/css" href="/static/style/base_layout.css">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.2/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-uWxY/CJNBR+1zjPWmfnSnVxwRheevXITnMqoEIeG1LJrdI0GlVs/9cVSyPYXdcSF" crossorigin="anonymous">
</head>
<style type="text/css">
select{ border:1px solid #ccc;
    padding-right:30px;
    appearance:none;
    -moz-appearance:none; /* Firefox */
    -webkit-appearance:none; /* Safari and Chrome */
    background-color:rgba(0,0,0,0);
}
select::-ms-expand {display: none;
}
button {
    width: 150px;
    padding:1px;
    background-color: #428bca;
    border-color: #357ebd;
    color: #fff;
    -moz-border-radius: 5px;
    -webkit-border-radius: 5px;
    border-radius: 5px; /* future proofing */
    -khtml-border-radius: 5px; /* for old Konqueror browsers */
    text-align: center;
    vertical-align: middle;
    border: 1px solid transparent;
    font-weight: 900;
    font-size:125%
}
</style>

<script>
    function refresh() {
        var start_time_value=document.getElementById("start_time").value
        var end_time_value=document.getElementById("end_time").value
        var start_time=start_time_value.split("-")[1]+start_time_value.split("-")[2]
        var end_time=end_time_value.split("-")[1]+end_time_value.split("-")[2]
        var time_data = document.getElementById('order_time').getAttribute('d');
        var order_id = document.getElementById('order_id').getAttribute('d');
        var order_customer = document.getElementById('order_customer').getAttribute('d');
        var order_bikeid = document.getElementById('order_bikeid').getAttribute('d');
        var order_ride = document.getElementById('order_ride').getAttribute('d');
        var order_cost = document.getElementById('order_cost').getAttribute('d');
        var time_string = time_data.substring(1, time_data.length - 1)
        var time_array = time_string.split(",")
        var order_id_string = order_id.substring(1, order_id.length - 1)
        var order_id_array = order_id_string.split(",")
        var order_customer_string = order_customer.substring(1, order_customer.length - 1)
        var order_customer_array = order_customer_string.split(",")
        var order_bikeid_string = order_bikeid.substring(1, order_bikeid.length - 1)
        var order_bikeid_array = order_bikeid_string.split(",")
        var order_ride_string = order_ride.substring(1, order_ride.length - 1)
        var order_ride_array = order_ride_string.split(",")
        var order_cost_string = order_cost.substring(1, order_cost.length - 1)
        var order_cost_array = order_cost_string.split(",")
        var innertext=" "
        for(var i=0;i<time_array.length;i++){
            var temp=time_array[i].split("-")[1]+time_array[i].split("-")[2]
            var time=Number(temp.replace("'",""))
            if(time-Number(start_time)>=0&&Number(end_time)-time>=0){
                innertext +="<tr><td>"+order_id_array[i]+
                    "</td><td>"+order_customer_array[i]+"</td><td>"+order_bikeid_array[i]+
                    "</td><td>"+order_ride_array[i]+"</td><td>"+order_cost_array[i]+
                    "</td><td>"+time_array[i]+"</td></tr>"
            }
        }
        console.log(innertext)
        document.getElementById("insert").innerHTML=innertext
    }
</script>
<body>
    <div>
        <div id="order" style="display: inline-block;left:800px;top:50px;position: absolute">
            </div>
        <div id="bike" style="left:0px;top:200px;position: absolute; background: #2B6695;border-radius: 6px 6px 6px 6px;box-shadow: 0 0 0 1px #5F5A4B, 1px 1px 6px 1px rgba(10, 10, 0, 0.5);color: #FFFFFF;font-family:Arial;font-size: 18px;
        font-weight: bold;height: 40px;width: 160px;line-height: 25px;margin: 18px 0 !important;padding: 8px 0 5px 5px;text-shadow: 2px 2px 3px #222222;">
            <p>Bike Information</p>
        </div>
        <dl>

            <div id="brand_pic" style="width: 600px;height:400px;display: inline-block;left:0px;top:300px;position: absolute"></div>
                <script type="text/javascript">
                var myChart = echarts.init(document.getElementById('brand_pic'));
                var option = {
                    title: {
                        text: 'Bike Brand',
                        subtext: ' ',
                        left: 'center'
                    },
                    tooltip: {
                        trigger: 'item'
                    },
                    legend: {
                        top: '5%',
                        left: 'center'
                    },
                    series: [
                        {
                            name: 'Bike Brand',
                            type: 'pie',
                            radius: ['40%', '70%'],
                            avoidLabelOverlap: false,
                            itemStyle: {
                            borderRadius: 10,
                            borderColor: '#fff',
                            borderWidth: 2
                        },
                    label: {
                        show: false,
                        position: 'center'
                    },
                    emphasis: {
                        label: {
                        show: true,
                        fontSize: '40',
                        fontWeight: 'bold'
                            }
                        },
                    labelLine: {
                        show: false
                    },
                    data: [
                        { value: {{bikes_brand[1][0]}}, name: '{{bikes_brand[0][0]}}' },
                        { value: {{bikes_brand[1][1]}}, name: '{{bikes_brand[0][1]}}' },
                        { value: {{bikes_brand[1][2]}}, name: '{{bikes_brand[0][2]}}' },
                        { value: {{bikes_brand[1][3]}}, name: '{{bikes_brand[0][3]}}' },
                        { value: {{bikes_brand[1][4]}}, name: '{{bikes_brand[0][4]}}' },
                        { value: {{bikes_brand[1][5]}}, name: '{{bikes_brand[0][5]}}'}
      ]
    }
  ]
};

        myChart.setOption(option);
    </script>
            <div id="bike_condition" style="width: 600px;height:400px;display: inline-block;left:600px;top:300px;position: absolute"></div>
                <script type="text/javascript">
                var myChart = echarts.init(document.getElementById('bike_condition'));
                var option = {
                            title: {
                                text: 'Bike Condition',
                                subtext: ' ',
                                left: 'center'
                            },
                    tooltip: {
                        trigger: 'item'
                    },
                    legend: {
                        orient: 'vertical',
                        left: 'right'
                    },
                    series: [
                        {
                            name: 'Bike Condition',
                            type: 'pie',
                            radius: '50%',
                            data: [
                                { value: {{ bikes_condition[0] }}, name: 'Good' },
                                { value: {{ bikes_condition[1] }}, name: 'Need Repair' },
                            ],
                            emphasis: {
                                itemStyle: {
                                    shadowBlur: 10,
                                    shadowOffsetX: 0,
                                    shadowColor: 'rgba(0, 0, 0, 0.5)'
                                }
                            }
                        }
                    ]
                };

        myChart.setOption(option);
    </script>
            <div id="bike_available" style="width: 600px;height:400px;display: inline-block;left:1200px;top:300px;position: absolute"></div>
                <script type="text/javascript">
                var myChart = echarts.init(document.getElementById('bike_available'));
                var option = {
                            title: {
                                text: 'Available Bikes',
                                subtext: ' ',
                                left: 'center'
                            },
                    tooltip: {
                        trigger: 'item'
                    },
                    legend: {
                        orient: 'vertical',
                        left: 'right'
                    },
                    series: [
                        {
                            name: 'Available Bikes',
                            type: 'pie',
                            radius: '50%',
                            data: [
                                { value: {{ available[0] }}, name: 'Available' },
                                { value: {{ available[1] }}, name: 'Unavailable' },
                            ],
                            emphasis: {
                                itemStyle: {
                                    shadowBlur: 10,
                                    shadowOffsetX: 0,
                                    shadowColor: 'rgba(0, 0, 0, 0.5)'
                                }
                            }
                        }
                    ]
                };

        myChart.setOption(option);
    </script>

        </dl>
         <div id="profit" style="left:0px;top:700px;position: absolute; background: #2B6695;border-radius: 6px 6px 6px 6px;box-shadow: 0 0 0 1px #5F5A4B, 1px 1px 6px 1px rgba(10, 10, 0, 0.5);color: #FFFFFF;font-family:Arial;font-size: 18px;
        font-weight: bold;height: 40px;width: 160px;line-height: 25px;margin: 18px 0 !important;padding: 8px 0 5px 5px;text-shadow: 2px 2px 3px #222222;">
            <p>Profit Information</p>
        </div>
        <div style="position: absolute;left:600px;top:750px;display: inline-block;">
            <p>
               Choose a month here:
            </p>
        </div>
        <div style="position: absolute;left:770px;top:750px;display: inline-block;">
            <form action="#" method="post" >
            <select name="month" id="month" onclick="select_option()">
                <option value="January">January</option>
                <option value="February">February</option>
                <option value="March">March</option>
                <option value="April">April</option>
                <option value="May">May</option>
                <option value="June">June</option>
                <option value="July">July</option>
                <option value="August">August</option>
                <option value="September">September</option>
                <option value="October">October</option>
                <option value="November">November</option>
                <option value="December">December</option>
            </select>
            </form>
        </div>
        <dl>
            <div>
                    <div id="order_time" d="{{orders_time}}" style="display:none"></div>
                    <div id="order_id" d="{{orders_id}}" style="display:none"></div>
                    <div id="order_customer" d="{{orders_customer}}" style="display:none"></div>
                    <div id="order_bikeid" d="{{orders_bikeid}}" style="display:none"></div>
                    <div id="order_ride" d="{{orders_ride}}" style="display:none"></div>
                    <div id="order_cost" d="{{orders_cost}}" style="display:none"></div>
                </div>
            <div id="profit_month" style="width: 600px;height:400px;display: inline-block;left:0px;top:800px;position: absolute"></div>
                <script type="text/javascript">
                    var myChart = echarts.init(document.getElementById('profit_month'));
                    var order_cost = document.getElementById('order_cost').getAttribute('d');
                    var order_cost_string = order_cost.substring(1, order_cost.length - 1)
                    var order_cost_array = order_cost_string.split(",")
                    var time_data = document.getElementById('order_time').getAttribute('d');
                    var time_string = time_data.substring(1, time_data.length - 1)
                    var time_array = time_string.split(",")
                    var day=new Date().getDate()
                    var month=new Date().getMonth()+1
                    var sum_value=0
                    var count=0
                    var innertext_cost="<h2>Total Orders Today: 0 </h2><h2>Total Profit Today: £ 0</h2>"
                    for(var i=0;i<order_cost_array.length;i++){

                        if(Number(time_array[i].split("-")[2].replace("'","")) == day && Number(time_array[i].split("-")[1]) == month) {
                            count += 1
                            sum_value += Number(Number(order_cost_array[i]).toFixed(2))

                            innertext_cost = "<h2>Total Orders Today: " + count + "</h2><h2>Total Profit Today: £" + sum_value + "</h2>"
                            document.getElementById("order").innerHTML = innertext_cost
                            console.log(innertext_cost)
                        }
                    }
                    document.getElementById("order").innerHTML=innertext_cost

                    let data = [0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0];
                    for(var i=0;i<time_array.length;i++){
                        var temp=time_array[i].split("-")[1]
                        var time=Number(temp.replace("'",""))
                        for(var j=1;j<13;j++){
                            if(time===j){
                            data[j-1] += Number(order_cost_array[i])
                            }
                        }

                    }



                    let dataAxis = ['1', '2', '3', '4', '5', '6', '7', '8', '9', '10', '11', '12'];

                    let yMax = 500;
                    let dataShadow = [];
                    for (let i = 0; i < data.length; i++) {
                        dataShadow.push(yMax);
                    }
                    var option = {
                        title: {
                            text: 'Profits of each month',
                            subtext: '2021'
                        },
                        xAxis: {
                            data: dataAxis,
                            axisLabel: {
                                inside: true,
                                color: '#fff'
                            },
                            axisTick: {
                                show: false
                            },
                            axisLine: {
                                show: false
                            },
                            z: 10
                        },
                        yAxis: {
                            axisLine: {
                                show: false
                            },
                            axisTick: {
                                show: false
                            },
                            axisLabel: {
                                color: '#999'
                            }
                        },
                        dataZoom: [
                            {
                                type: 'inside'
                            }
                        ],
                        series: [
                            {
                                type: 'bar',
                                showBackground: true,
                                itemStyle: {
                                    color: new echarts.graphic.LinearGradient(0, 0, 0, 1, [
                                        { offset: 0, color: '#83bff6' },
                                        { offset: 0.5, color: '#188df0' },
                                        { offset: 1, color: '#188df0' }
                                    ])
                                },
                                emphasis: {
                                    itemStyle: {
                                        color: new echarts.graphic.LinearGradient(0, 0, 0, 1, [
                                            { offset: 0, color: '#2378f7' },
                                            { offset: 0.7, color: '#2378f7' },
                                            { offset: 1, color: '#83bff6' }
                                        ])
                                    }
                                },
                                data: data
                            }
                        ]
                    };
                    // Enable data zoom when user click bar.
                    const zoomSize = 6;
                    myChart.on('click', function (params) {
                        console.log(dataAxis[Math.max(params.dataIndex - zoomSize / 2, 0)]);
                        myChart.dispatchAction({
                        type: 'dataZoom',
                        startValue: dataAxis[Math.max(params.dataIndex - zoomSize / 2, 0)],
                        endValue:
                            dataAxis[Math.min(params.dataIndex + zoomSize / 2, data.length - 1)]
                        });
                    });

                    option && myChart.setOption(option);
    </script>
            <div id="profit_day" style="width: 1200px;height:400px;display: inline-block;left:600px;top:800px;position: absolute"></div>
                <script type="text/javascript">
                    function select_option(){
                        var myChart = echarts.init(document.getElementById('profit_day'));
                        obj=document.getElementById("month");
                        var index = obj.selectedIndex;

                        if(  index == 0||index ==2||index ==4||index ==6||index ==7||index ==9||index ==11) {
                            var data_day = []
                            var dataAxis_day = []
                            for (var i = 0; i < 31; i++) {
                                data_day[i] = 0;
                                dataAxis_day[i]=i+1
                            }

                        }
                        if( index ==3||index ==5||index ==8||index ==10) {
                            var data_day = []
                            var dataAxis_day = []
                            for (var i = 0; i < 30; i++) {
                                data_day[i] = 0;
                                dataAxis_day[i]=i+1
                            }
                        }
                        if(index==1){
                            var data_day = []
                            var dataAxis_day = []
                            for (var i = 0; i < 28; i++) {
                                data_day[i] = 0;
                                dataAxis_day[i]=i+1
                            }
                        }
                        for(var i=0;i<time_array.length;i++){
                            var month_value=Number(time_array[i].split("-")[1])
                            var day_temp=time_array[i].split("-")[2]
                            var day_value=Number(day_temp.replace("'",""))
                            if(month_value==index+1){
                                for(var j=1;j<32;j++){
                                    if(day_value===j){
                                        data_day[j-1] += Number(order_cost_array[i])
                                    }
                                }
                            }
                        }
                    let yMax_day = 500;
                    let dataShadow_day= [];
                    for (let w = 0; w < data_day.length; w++) {
                        dataShadow_day.push(yMax_day);
                    }
                    var option = {
                        title: {
                            text: 'Profits of each day',
                            subtext: obj.options[index].value
                        },
                        xAxis: {
                            data: dataAxis_day,
                            axisLabel: {
                                inside: true,
                                color: '#fff'
                            },
                            axisTick: {
                                show: false
                            },
                            axisLine: {
                                show: false
                            },
                            z: 10
                        },
                        yAxis: {
                            axisLine: {
                                show: false
                            },
                            axisTick: {
                                show: false
                            },
                            axisLabel: {
                                color: '#999'
                            }
                        },
                        dataZoom: [
                            {
                                type: 'inside'
                            }
                        ],
                        series: [
                            {
                                type: 'bar',
                                showBackground: true,
                                itemStyle: {
                                    color: new echarts.graphic.LinearGradient(0, 0, 0, 1, [
                                        { offset: 0, color: '#83bff6' },
                                        { offset: 0.5, color: '#188df0' },
                                        { offset: 1, color: '#188df0' }
                                    ])
                                },
                                emphasis: {
                                    itemStyle: {
                                        color: new echarts.graphic.LinearGradient(0, 0, 0, 1, [
                                            { offset: 0, color: '#2378f7' },
                                            { offset: 0.7, color: '#2378f7' },
                                            { offset: 1, color: '#83bff6' }
                                        ])
                                    }
                                },
                                data: data_day
                            }
                        ]
                    };
// Enable data zoom when user click bar.
const zoomSize_day = 6;
myChart.on('click', function (params) {
  console.log(dataAxis_day[Math.max(params.dataIndex - zoomSize_day / 2, 0)]);
  myChart.dispatchAction({
    type: 'dataZoom',
    startValue: dataAxis_day[Math.max(params.dataIndex - zoomSize_day / 2, 0)],
    endValue:
      dataAxis_day[Math.min(params.dataIndex + zoomSize_day / 2, data_day.length - 1)]
  });
});

        option && myChart.setOption(option);}
                    window.onload=select_option
    </script>
            <div id="order_info" style="left:0px;top:1200px;position: absolute; background: #2B6695;border-radius: 6px 6px 6px 6px;box-shadow: 0 0 0 1px #5F5A4B, 1px 1px 6px 1px rgba(10, 10, 0, 0.5);color: #FFFFFF;font-family:Arial;font-size: 18px;
        font-weight: bold;height: 40px;width: 160px;line-height: 25px;margin: 18px 0 !important;padding: 8px 0 5px 5px;text-shadow: 2px 2px 3px #222222;">
            <p>Order Information</p>
            </div>
            <div id="recent_orders" style="width: 600px;height:400px;display: inline-block;left:600px;top:1300px;position: absolute">
                <p style="display: inline-block;">From: </p>
                <input id="start_time" name="start_time" style="display: inline-block;" type="date"  min="2021-01-01" max="2021-12-31"/>
                 <p style="display: inline-block;">To: </p>
                <input id="end_time" name="end_time" style="display: inline-block;" type="date"  min="2021-01-01" max="2021-12-31"/>
                <button type="button" onclick="refresh();">Search</button>
            </div>

            <div id="order_table" style="">
                <table style="width:1800px;height:600px;left:100px;top:1400px;position: absolute">
                    <thead class="thread-light">
                        <tr>
                            <th scope = "col">Order ID</th>
                            <th scope = "col">Customer ID</th>
                            <th scope = "col">Bike ID</th>
                            <th scope = "col">Riding Duration</th>
                            <th scope = "col">Cost</th>
                            <th scope = "col">Record Time</th>
                        </tr>
                    </thead>
                    <tbody id="insert"></tbody>
                </table>
            </div>

        </dl>
    </div>
</body>
</html>